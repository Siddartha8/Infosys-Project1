<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Admin Dashboard - Review Analysis</title>
    <style>
        :root {
            --primary: #17a2b8;
            --positive: #28a745;
            --negative: #dc3545;
            --neutral: #6c757d;
            --info: #17a2b8;
            --warning: #ffc107;
            --bg-dark: #1e1f26;
            --bg-light: #2c2f38;
            --text-light: #f1f3f5;
            --card-bg: #2a2d35;
            --sidebar-width: 250px; 
            --sidebar-bg: #1a1a20; 
        }
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-light);
            margin: 0;
            transition: background 0.4s, color 0.4s;
            display: flex; 
        }
        body.light-mode {
            background: #f1f3f5;
            color: #1e1f26;
        }

        /* Sidebar styles */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-width);
            background: var(--sidebar-bg);
            height: 100vh;
            position: fixed; 
            top: 0;
            left: 0;
            padding-top: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.6);
            overflow-y: auto;
            z-index: 20;
        }
        body.light-mode .sidebar {
            background: #e9ecef;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .sidebar-header {
            color: var(--text-light);
            padding: 10px 20px 20px 20px;
            font-size: 1.5rem;
            font-weight: 700;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 10px;
        }
        body.light-mode .sidebar-header {
            color: #1e1f26;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--text-light);
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.2s, color 0.2s;
            border-left: 5px solid transparent;
        }
        body.light-mode .sidebar-nav a {
            color: #1e1f26;
        }
        .sidebar-nav a i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: var(--bg-light);
            border-left: 5px solid var(--primary);
            color: var(--text-light);
        }
        body.light-mode .sidebar-nav a.active {
            background: #d0d5da;
            color: var(--primary);
        }
        
        /* Main Content styles */
        .main-content {
            margin-left: var(--sidebar-width);
            flex-grow: 1;
            padding-bottom: 50px;
            /* CRITICAL FIX: Ensure the main content doesn't force a scroll on the body */
            min-width: calc(100% - var(--sidebar-width)); 
            overflow-x: hidden;
        }

        /* Header (for title and logout) */
        header {
            background: var(--bg-dark); 
            color: var(--text-light);
            padding: 1rem 25px;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.6);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        body.light-mode header {
            background: #f1f3f5;
            color: #1e1f26;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        header h1 {
            font-size: 1.8rem;
            margin: 0;
            padding-left: 10px;
        }
        /* Override existing nav styles */
        nav {
            display: none !important; 
        }
        .logout-btn {
            position: static; 
        }
        /* Container to hold the actual content inside main-content */
        .container {
            width: 95%; 
            max-width: 1400px; 
            margin: 25px auto;
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px; 
                min-width: 70px;
            }
            .main-content {
                margin-left: 70px;
                min-width: calc(100% - 70px);
            }
            .sidebar-header span, .sidebar-nav a span {
                display: none; 
            }
            .sidebar-nav a {
                justify-content: center;
            }
            .sidebar-nav a i {
                margin: 0;
            }
        }

        /* --- REVIEW TABLE FIXES --- */
        .detailed-reviews-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: 0 0 12px 12px;
            overflow: hidden;
        }
        
        .detailed-reviews-table {
            table-layout: auto; 
            min-width: 1200px; 
        }

        /* Column Width Definitions for Detailed Reviews Table */
        .detailed-reviews-table th:nth-child(1),
        .detailed-reviews-table td:nth-child(1) { width: 80px; } /* Identifier */
        .detailed-reviews-table th:nth-child(2),
        .detailed-reviews-table td:nth-child(2) { width: 25%; max-width: 300px; } /* Text */
        .detailed-reviews-table th:nth-child(3),
        .detailed-reviews-table td:nth-child(3) { width: 30%; max-width: 350px; } /* Pipeline Steps */
        .detailed-reviews-table th:nth-child(4),
        .detailed-reviews-table td:nth-child(4) { width: 25%; max-width: 250px; } /* Aspects */
        
        /* Fixed/Constrained widths for dense columns */
        .detailed-reviews-table th:nth-child(5),
        .detailed-reviews-table td:nth-child(5) { width: 100px; } /* Sentiment */
        .detailed-reviews-table th:nth-child(6),
        .detailed-reviews-table td:nth-child(6) { width: 120px; } /* Confidence */
        .detailed-reviews-table th:nth-child(7),
        .detailed-reviews-table td:nth-child(7) { width: 80px; } /* Rating */
        .detailed-reviews-table th:nth-child(8),
        .detailed-reviews-table td:nth-child(8) { width: 120px; } /* Created At */

        /* Ensure wrapping for all cells */
        .detailed-reviews-table th,
        .detailed-reviews-table td {
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            vertical-align: top;
        }
        
        /* Pipeline Steps Styling Adjustment */
        .pipeline-steps {
            font-size: 0.8rem; 
            line-height: 1.3;
        }
        .pipeline-step {
            margin: 2px 0; 
            padding: 1px 0;
        }
        .pipeline-step strong {
            display: inline-block;
            margin-right: 5px; 
            min-width: 70px; 
            text-align: right;
            color: var(--primary);
        }
        .pipeline-step span {
            display: inline; 
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal !important;
            color: #ccc;
        }
        
        /* IMPORTANT: Wrapper for horizontal scroll */
        .table-scroll-wrapper {
            overflow-x: auto;
        }

        /* --- END REVIEW TABLE FIXES --- */


        body.light-mode .detailed-reviews-table {
            background: #f8f9fa;
            color: #1e1f26;
        }
        .detailed-reviews-table th {
            background: var(--bg-light);
            color: var(--primary);
            padding: 12px;
            font-weight: 600;
            text-align: left;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        body.light-mode .detailed-reviews-table th {
            background: #e9ecef;
            color: #1e1f26;
            border-bottom: 2px solid #dee2e6;
        }
        .detailed-reviews-table td {
            padding: 15px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            vertical-align: top;
        }
        body.light-mode .detailed-reviews-table td {
            border-bottom: 1px solid #dee2e6;
        }
        .detailed-reviews-table tr:hover {
            background: rgba(255,255,255,0.03);
        }
        body.light-mode .detailed-reviews-table tr:hover {
            background: #f1f3f5;
        }
        /* Overview cards styling (only in Analytics section) */
        .system-overview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }
        .overview-card {
            background: var(--card-bg);
            flex: 1 1 220px;
            min-width: 180px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        body.light-mode .overview-card {
            background: #f8f9fa;
            color: #1e1f26;
        }
        .overview-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }
        .overview-card p {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }
        .overview-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        /* User Section Styling */
        .user-section {
            margin-bottom: 40px;
        }
        .user-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* User Management Buttons */
        .user-actions button {
            margin-left: 8px;
            padding: 6px 12px;
            font-size: 0.9rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        .user-actions button.activate { background-color: #28a745; color: #fff; }
        .user-actions button.deactivate { background-color: #ffc107; color: #212529; }
        .user-actions button.delete { background-color: #dc3545; color: #fff; }
        .user-actions button.reset { background-color: #007bff; color: #fff; } 

        .user-actions button.activate:hover { background-color: #218838; }
        .user-actions button.deactivate:hover { background-color: #e0a800; }
        .user-actions button.delete:hover { background-color: #c82333; }
        .user-actions button.reset:hover { background-color: #0069d9; }

        
        /* Aspect Item and Sentiment Badge remain standard */
        .aspect-item {
            display: inline-block;
            margin: 2px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            word-break: break-word;
        }
        .aspect-item.positive { 
            background: rgba(40,167,69,0.15); 
            color: var(--positive); 
        }
        .aspect-item.negative { 
            background: rgba(220,53,69,0.15); 
            color: var(--negative); 
        }
        .aspect-item.neutral { 
            background: rgba(108,117,125,0.15); 
            color: var(--neutral); 
        }
        /* Sentiment Badge */
        .sentiment-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: capitalize;
        }
        .sentiment-badge.positive { 
            background: rgba(40,167,69,0.2); 
            color: var(--positive); 
        }
        .sentiment-badge.negative { 
            background: rgba(220,53,69,0.2); 
            color: var(--negative); 
        }
        .sentiment-badge.neutral { 
            background: rgba(108,117,125,0.2); 
            color: var(--neutral); 
        }
        /* Rating Stars */
        .rating-stars {
            color: #ffc107;
            font-size: 1.1rem;
        }
        /* Standard tables for Analytics */
        table.reviews-table, .mini-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
        }
        body.light-mode table.reviews-table,
        body.light-mode .mini-table {
            background: #f3f3f3;
            color: #1e1f26;
        }
        table.reviews-table th, table.reviews-table td,
        .mini-table th, .mini-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        body.light-mode table.reviews-table th,
        body.light-mode .mini-table th {
            background: #e6e8ea;
            color: var(--primary);
        }
        /* Sentiment labels */
        .sentiment {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            display: inline-block;
        }
        .positive { background: rgba(40,167,69,0.15); color: var(--positive); }
        .negative { background: rgba(220,53,69,0.15); color: var(--negative); }
        .neutral	{ background: rgba(108,117,125,0.15); color: var(--neutral); }

        /* NEW: CHART ROW FLEX CONTAINER */
        .chart-row {
            display: flex;
            flex-wrap: wrap; 
            gap: 20px;
            margin-bottom: 25px; 
        }

        /* Chart container styles */
        .chart-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.5);
            flex: 1 1 45%;	
            min-width: 300px;
            max-width: none;	
            margin: 0 !important; 
            text-align: center;
        }
        body.light-mode .chart-container {
            background: #f3f3f3;
            color: #1e1f26;
        }
        .chart-container canvas {
            width: 100% !important;
            height: 300px !important; 
            margin: auto;
        }
        .chart-container p {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 15px;
            line-height: 1.6;
        }
        .chart-container p strong {
            font-weight: 700;
        }
        .chart-container .positive { color: var(--positive); }
        .chart-container .negative { color: var(--negative); }
        .chart-container .neutral	{ color: var(--neutral); }

        /* Logout button style */
        .logout-btn {
            background: var(--negative);
            color: #fff;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .logout-btn:hover {
            background: #a71d2a;
        }
        h2 {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 12px;
        }
        p {
            line-height: 1.5;
        }
        /* Settings styles */
        .settings-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        body.light-mode .settings-card {
            background: #f3f3f3;
            color: #1e1f26;
        }
        .settings-card label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .settings-card button {
            padding: 7px 14px;
            background: var(--primary);
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
        }
        .settings-card button:hover {
            background: #138496;
        }
        body.light-mode .settings-card button {
            background: #17a2b8;
        }
        /* Badges */
        .badge {
            display: inline-block;
            margin-left: 6px;
            background: var(--primary);
            color: #fff;
            border-radius: 7px;
            font-size: 0.78em;
            padding: 2px 7px;
        }
        .badge.admin { background: var(--negative); }
        .badge.vip { background: var(--positive); }

        /* Identifier style */
        .identifier-column {
            font-weight: 600;
            text-transform: lowercase;
        }

        /* Export button styled as link */
        a.button {
            display: inline-block;
            padding: 8px 14px;
            background-color: #17a2b8;
            color: #fff;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
        }
        a.button:hover {
            background-color: #138496;
        }

        /* User table styles */
        .user-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        body.light-mode .user-table {
            background: #f8f9fa;
            color: #1e1f26;
        }
        .user-table th {
            background: var(--bg-light);
            color: var(--primary);
            padding: 12px;
            font-weight: 600;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        body.light-mode .user-table th {
            background: #e9ecef;
        }
        .user-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        body.light-mode .user-table td {
            border-bottom: 1px solid #dee2e6;
        }
        /* Forms and inputs */
        .form-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        .form-container input[type="text"] {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #555;
            background: #333;
            color: #fff;
            margin-right: 10px;
        }
        body.light-mode .form-container { background: #f3f3f3; }
        body.light-mode .form-container input[type="text"] { background: #fff; color: #000; border-color: #ccc; }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: var(--card-bg);
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 12px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover, .close:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-content input, .modal-content button {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        
        /* New styles for System Monitoring section */
        .monitoring-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .monitoring-section h3 {
            color: var(--primary);
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            margin-top: 0;
        }
        .log-item {
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 8px 0;
            font-size: 0.95rem;
        }
        .log-item:last-child {
            border-bottom: none;
        }
        .log-timestamp {
            font-weight: bold;
            color: #888;
        }
        .log-message {
            margin-left: 10px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        .stat-item:last-child {
            border-bottom: none;
        }
        .stat-label {
            font-weight: bold;
        }
        .stat-value {
            color: var(--primary);
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            color: #fff;
        }
        .status-badge.success { background-color: var(--positive); }
        .status-badge.fail { background-color: var(--negative); }
        .model-check-item {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .model-check-item p { margin: 5px 0; }
        .model-check-item button {
            background-color: var(--primary);
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .model-check-item button.correct { background-color: var(--positive); }
        .model-check-item button.incorrect { background-color: var(--negative); }
        
        /* New styles for Admin Reports section */
        .report-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .report-section h3 {
            color: var(--primary);
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            margin-top: 0;
        }
        .report-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .stat-card {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-card p {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .stat-card span {
            font-size: 0.9rem;
            color: #aaa;
        }
        .table-container {
            overflow-x: auto;
        }
        .report-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-light);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
        }
        .report-table th, .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .report-table th {
            background: var(--primary);
            color: #fff;
            font-weight: 600;
        }
        .report-table tr:hover {
            background: rgba(255,255,255,0.05);
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .button-group a {
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            color: #fff;
            transition: background 0.3s;
        }
        .button-group a.csv {
            background-color: var(--positive);
        }
        .button-group a.csv:hover {
            background-color: #218838;
        }
        .button-group a.pdf {
            background-color: var(--negative);
        }
        .button-group a.pdf:hover {
            background-color: #c82333;
        }
        /* NEW: Feedback & Support Specific Styles */
        .feedback-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        .feedback-grid .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .feedback-grid .card h3 {
            color: var(--primary);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        .feedback-grid form label {
            display: block;
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .feedback-grid form select, 
        .feedback-grid form textarea,
        .feedback-grid form input[type="file"] {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #444;
            background: var(--bg-light);
            color: var(--text-light);
            box-sizing: border-box;
            margin-bottom: 10px;
        }
        .feedback-grid form button {
            padding: 10px 20px;
            background-color: var(--positive);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        .feedback-grid form button:hover {
            background-color: #218838;
        }
        .feedback-grid ul {
            list-style: none;
            padding: 0;
        }
        .feedback-grid ul li {
            background: var(--bg-light);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }
        /* Feedback Status Table */
        .feedback-table .status-pending { background: rgba(255,193,7,0.2); color: var(--warning); }
        .feedback-table .status-in-progress { background: rgba(23,162,184,0.2); color: var(--info); }
        .feedback-table .status-resolved { background: rgba(40,167,69,0.2); color: var(--positive); }
        .feedback-table select {
            padding: 5px 8px;
            border-radius: 4px;
            border: 1px solid #444;
            background: var(--bg-light);
            color: var(--text-light);
        }
        @media (max-width: 900px) {
            .feedback-grid {
                grid-template-columns: 1fr;
            }
        }
        
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<aside class="sidebar">
    <div class="sidebar-header">Admin Panel</div>
    <div class="sidebar-nav">
        <a href="#analytics" id="analyticsLink" onclick="showTab('analytics', this)"><i class="fas fa-chart-line"></i> <span>Dashboard</span></a>
        <a href="#reviews" id="reviewsLink" onclick="showTab('reviews', this)"><i class="fas fa-comments"></i> <span>Reviews</span></a>
        <a href="#user_management" id="user_managementLink" onclick="showTab('user_management', this)"><i class="fas fa-users-cog"></i> <span>User Management</span></a>
        <a href="#aspect_categories" id="aspect_categoriesLink" onclick="showTab('aspect_categories', this)"><i class="fas fa-tags"></i> <span>Aspect Categories</span></a>
        <a href="#system_monitoring" id="system_monitoringLink" onclick="showTab('system_monitoring', this)"><i class="fas fa-desktop"></i> <span>System Monitoring</span></a>
        <a href="#admin_reports" id="admin_reportsLink" onclick="showTab('admin_reports', this)"><i class="fas fa-file-alt"></i> <span>Admin Reports</span></a>
        <a href="#feedback_support" id="feedback_supportLink" onclick="showTab('feedback_support', this)"><i class="fas fa-life-ring"></i> <span>Feedback & Support</span></a>
        <a href="#settings" id="settingsLink" onclick="showTab('settings', this)"><i class="fas fa-cogs"></i> <span>Settings</span></a>
    </div>
</aside>

<div class="main-content">
    <header>
        <h1>Admin Dashboard - Review Analysis</h1>
        <a href="{{ url_for('admin_logout') }}"><button class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button></a>
    </header>
    
    <div class="container">

        <div id="overviewSection" style="display: none;">
            <div class="system-overview" id="overviewCounts">
                <div class="overview-card">
                    <h3>Total Registered Users</h3>
                    <p>{{ total_users }}</p>
                </div>
                <div class="overview-card">
                    <h3>Total Datasets Uploaded</h3>
                    <p>{{ total_datasets }}</p>
                </div>
                <div class="overview-card">
                    <h3>Total Reviews Processed</h3>
                    <p>{{ total_reviews }}</p>
                </div>
                <div class="overview-card">
                    <h3>Recent Activity</h3>
                    <p>{{ recent_activity }}</p>
                </div>
            </div>
        </div>

        <div id="analytics" style="display:none;">
            <h2>Analytics Overview</h2>
            <table class="mini-table">
                <thead>
                    <tr>
                        <th>Total Reviews</th>
                        <th>Positive</th>
                        <th>Negative</th>
                        <th>Neutral</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ pos_count + neg_count + neu_count }}</td>
                        <td>{{ pos_count }}</td>
                        <td>{{ neg_count }}</td>
                        <td>{{ neu_count }}</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="chart-row">
                <div class="chart-container">
                    <canvas id="sentimentChart"></canvas>
                    <p>
                        <strong class="positive">Positive:</strong> {{ pos_count }} | 
                        <strong class="negative">Negative:</strong> {{ neg_count }} | 
                        <strong class="neutral">Neutral:</strong> {{ neu_count }}
                    </p>
                </div>

                <div class="chart-container">
                    <canvas id="aspectChart"></canvas>
                    <p>
                        <strong>Total Aspects:</strong> {{ admin_aspect_data|length }}<br>
                        <strong>Summary:</strong> 
                        <span class="positive">{{ admin_aspect_data|selectattr("label","equalto","Positive")|list|length }} Positive</span>, 
                        <span class="negative">{{ admin_aspect_data|selectattr("label","equalto","Negative")|list|length }} Negative</span>, 
                        <span class="neutral">{{ admin_aspect_data|selectattr("label","equalto","Neutral")|list|length }} Neutral</span>
                    </p>
                </div>
            </div>
            <h2>Aspect Sentiment Analysis</h2>
            <table class="mini-table">
                <thead>
                    <tr><th>Aspect</th><th>Sentiment</th><th>Confidence</th></tr>
                    </tr>
                </thead>
                <tbody>
                    {% for asp in admin_aspect_data %}
                    <tr>
                        <td>{{ asp.aspect }}</td>
                        <td><span class="sentiment {{ asp.label|lower }}">{{ asp.label }}</span></td>
                        <td>
                            {% if asp.score is not none %}
                                {{ "%.2f"|format(asp.score * 100) }}%
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div id="reviews" style="display:none;">
            {% for username, reviews in reviews_by_user.items() %}
                {% set user_obj = None %}
                {% if reviews|length > 0 %}
                    {% set user_obj = reviews[0].user %}
                {% endif %}
                <div class="user-section">
                    <div class="user-header">
                        User: {{ username }}
                        {% if username == 'admin' %}
                            <span class="badge admin">ADMIN</span>
                        {% elif username.lower().startswith('vip') %}
                            <span class="badge vip">VIP</span>
                        {% endif %}
                        {% if user_obj and user_obj.active %}
                            <button class="deactivate" onclick="changeUserStatus({{ user_obj.id }}, false)">Deactivate</button>
                        {% else %}
                            <button class="activate" onclick="changeUserStatus({{ user_obj.id }}, true)">Activate</button>
                        {% endif %}
                        {% if user_obj %}
                            <button class="delete" onclick="deleteUser({{ user_obj.id }})">Delete</button>
                        {% endif %}
                    </div>
                    <div class="table-scroll-wrapper"> 
                        <table class="detailed-reviews-table">
                            <thead>
                                <tr>
                                    <th>Identifier</th>
                                    <th>Text</th>
                                    <th>Pipeline Steps</th>
                                    <th>Aspects</th>
                                    <th>Sentiment</th>
                                    <th>Confidence</th>
                                    <th>Rating</th>
                                    <th>Created At</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for review in reviews %}
                                <tr>
                                    <td class="identifier-column">{{ username }}</td>
                                    <td class="text-column">{{ review.text }}</td>
                                    <td class="pipeline-steps">
                                        {% if review.pipeline_steps %}
                                            {% for step in review.pipeline_steps %}
                                            <div class="pipeline-step">
                                                <strong>{{ step.name }}:</strong> <span>
                                                    {{ step.text }}
                                                </span>
                                            </div>
                                            {% endfor %}
                                        {% else %}
                                            <div class="pipeline-step"><strong>Original:</strong> <span>{{ review.text[:50] }}{% if review.text|length > 50 %}...{% endif %}</span></div>
                                            <div class="pipeline-step"><strong>Cleaned:</strong> <span>Processing...</span></div>
                                            <div class="pipeline-step"><strong>Tokenized:</strong> <span>Processing...</span></div>
                                            <div class="pipeline-step"><strong>Processed:</strong> <span>Processing...</span></div>
                                        {% endif %}
                                    </td>
                                    <td class="aspects-column">
                                        {% if review.aspect_tags %}
                                            {% for aspect_tag in review.aspect_tags %}
                                            <span class="aspect-item {{ aspect_tag.label|lower }}">
                                                {{ aspect_tag.aspect }} ({{ aspect_tag.label }})
                                            </span>
                                            {% endfor %}
                                        {% else %}
                                            <span class="aspect-item neutral">No aspects found</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="sentiment-badge {{ review.sentiment_label|lower }}">
                                            {{ review.sentiment_label }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if review.sentiment_score is not none %}
                                            {{ "%.2f"|format(review.sentiment_score * 100) }}%
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="rating-stars">
                                            {% set rating = review.rating or 3 %}
                                            {% for i in range(rating) %}‚òÖ{% endfor %}
                                            {% if rating < 5 %}
                                                {% for i in range(5 - rating) %}‚òÜ{% endfor %}
                                            {% endif %}
                                        </span>
                                    </td>
                                    <td>{{ review.timestamp }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div> </div>
            {% endfor %}
        </div>

        <div id="user_management" style="display:none;">
            <h2>User Management</h2>
            <table class="user-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>No. of Datasets Uploaded</th>
                        <th>Last Active Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.reviews|length }}</td>
                        <td>
                            {% set last_review = user.reviews|sort(attribute='created_at', reverse=True)|first %}
                            {% if last_review %}
                                {{ last_review.created_at.strftime("%Y-%m-%d") }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td class="user-actions">
                            {% if user.active %}
                                <button class="deactivate" onclick="changeUserStatus({{ user.id }}, false)">Deactivate</button>
                            {% else %}
                                <button class="activate" onclick="changeUserStatus({{ user.id }}, true)">Activate</button>
                            {% endif %}
                            <button class="reset" onclick="resetPassword({{ user.id }})">Reset Password</button>
                            <button class="delete" onclick="deleteUser({{ user.id }})">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div id="aspect_categories" style="display:none;">
            <h2>Aspect Category Management</h2>
            <div class="form-container">
                <h3>Add New Aspect</h3>
                <input type="text" id="newAspectName" placeholder="Enter new aspect name">
                <button onclick="addAspect()">Add Aspect</button>
            </div>
            <table class="user-table" id="aspectsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Aspect Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for aspect in aspects %}
                    <tr id="aspect-row-{{ aspect.id }}">
                        <td>{{ aspect.id }}</td>
                        <td>{{ aspect.name }}</td>
                        <td class="user-actions">
                            <button onclick="editAspect({{ aspect.id }}, '{{ aspect.name }}')">Edit</button>
                            <button class="delete" onclick="deleteAspect({{ aspect.id }})">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div id="system_monitoring" style="display:none;">
            <h2>System Monitoring</h2>
            <p>Monitor system health and performance here.</p>
            <div class="monitoring-section">
                <h3>Performance Logs</h3>
                <div id="performance-logs-container">
                    <p>Loading logs...</p>
                </div>
            </div>
            <div class="monitoring-section">
                <h3>Model Accuracy Check</h3>
                <div id="model-accuracy-container">
                    <p>Fetching a sample review...</p>
                </div>
            </div>
            <div class="monitoring-section">
                <h3>Server/Storage Usage</h3>
                <div id="server-stats-container">
                    <p>Fetching server statistics...</p>
                </div>
            </div>
        </div>
        
        <div id="admin_reports" style="display:none;">
            <h2>Admin Reports</h2>
            <div class="report-section">
                <h3>Download Report</h3>
                <div class="button-group">
                    <a href="{{ url_for('generate_system_report') }}" class="button csv">Download CSV Report</a>
                    <a href="{{ url_for('generate_system_pdf_report') }}" class="button pdf">Download PDF Report</a>
                </div>
            </div>

            <div class="report-section">
                <h3>Total Reviews Analyzed</h3>
                <div class="report-stats-grid">
                    <div class="stat-card">
                        <p>{{ reviews_today }}</p>
                        <span>Last 24 hours</span>
                    </div>
                    <div class="stat-card">
                        <p>{{ reviews_week }}</p>
                        <span>Last 7 days</span>
                    </div>
                    <div class="stat-card">
                        <p>{{ reviews_month }}</p>
                        <span>Last 30 days</span>
                    </div>
                </div>
            </div>

            <div class="report-section">
                <h3>Total Datasets Uploaded</h3>
                <div class="report-stats-grid">
                    <div class="stat-card">
                        <p>{{ total_reviews }}</p>
                        <span>Total Reviews</span>
                    </div>
                </div>
            </div>

            <div class="report-section">
                <h3>Most Active Users (Top 10)</h3>
                <div class="table-container">
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>User Name</th>
                                <th>Review Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in most_active_users %}
                            <tr>
                                <td>{{ user.username }}</td>
                                <td>{{ user.review_count }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="report-section">
                <h3>Most Common Aspects (Top 10)</h3>
                <div class="table-container">
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Aspect</th>
                                <th>Positive</th>
                                <th>Negative</th>
                                <th>Neutral</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for aspect in common_aspects %}
                            <tr>
                                <td>{{ aspect.aspect }}</td>
                                <td><span class="sentiment-badge positive">{{ aspect.positive }}</span></td>
                                <td><span class="sentiment-badge negative">{{ aspect.negative }}</span></td>
                                <td><span class="sentiment-badge neutral">{{ aspect.neutral }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="feedback_support" style="display:none;">
            <h2>Feedback & Support</h2>
            <div class="feedback-grid">
                <div class="card">
                    <h3>Submit Feedback</h3>
                    <form method="POST" enctype="multipart/form-data">
                        <label for="category">Category</label>
                        <select id="category" name="category" required>
                            <option value="Bug">üêû Bug Report</option>
                            <option value="Feature">‚ú® Feature Request</option>
                            <option value="Data Issue">‚ö†Ô∏è Data Issue</option>
                            <option value="General">üí¨ General Feedback</option>
                        </select>

                        <label for="message">Message</label>
                        <textarea id="message" name="message" rows="4" placeholder="Describe your issue or suggestion..." required></textarea>

                        <label for="attachment">Attach File (Optional)</label>
                        <input type="file" id="attachment" name="attachment">

                        <button type="submit">Submit Feedback</button>
                    </form>
                </div>

                <div>
                    <div class="card" style="margin-bottom: 25px;">
                        <h3>Support Contact</h3>
                        <p>üìß <a href="mailto:support@reviewsense.com" style="color: var(--primary); text-decoration: none;">support@reviewsense.com</a></p>
                        <p>‚è±Ô∏è Response within 24 hours</p>
                    </div>
                    <div class="card">
                        <h3>Frequently Asked Questions</h3>
                        <ul>
                            <li><b>How do I upload reviews?</b> ‚Üí Go to the **Reviews** tab and upload a CSV file.</li>
                            <li><b>Where can I see sentiment reports?</b> ‚Üí Check the **Admin Reports** tab for downloadable system reports.</li>
                            <li><b>How do I reset a user's password?</b> ‚Üí Go to **User Management** and click the "Reset Password" button next to the user.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3>Track Submitted Feedback</h3>
            <div class="table-container">
                <table class="report-table feedback-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Message</th>
                            <th>Attachment</th>
                            <th>Status</th>
                            <th>Change Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in submitted_feedback %}
                        <tr data-feedback-id="{{ item.id }}">
                            <td>{{ item.id }}</td>
                            <td>{{ item.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>{{ item.category }}</td>
                            <td>{{ item.message[:100] }}{% if item.message|length > 100 %}...{% endif %}</td>
                            <td>
                                {% if item.attachment %}
                                    {% set filename = item.attachment|split('_')|last %}
                                    <a href="{{ url_for('download_attachment', filename=item.attachment) }}" class="button" style="padding: 4px 8px; font-size: 0.8rem;" target="_blank">Download ({{ filename }})</a>
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                            <td><span class="sentiment-badge status-{{ item.status|lower|replace(' ', '-') }}">{{ item.status }}</span></td>
                            <td>
                                <select onchange="updateFeedbackStatus({{ item.id }}, this.value)">
                                    <option value="Pending" {% if item.status == 'Pending' %}selected{% endif %}>Pending</option>
                                    <option value="In Progress" {% if item.status == 'In Progress' %}selected{% endif %}>In Progress</option>
                                    <option value="Resolved" {% if item.status == 'Resolved' %}selected{% endif %}>Resolved</option>
                                </select>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% if not submitted_feedback %}
                    <p style="text-align: center; padding: 20px;">No feedback tickets have been submitted yet.</p>
                {% endif %}
            </div>
        </div>

        <div id="settings" style="display:none;">
            <h2>Settings</h2>
            <div class="settings-card">
                <label>Appearance:</label>
                <button id="toggleThemeBtn">Toggle Dark/Light</button>
            </div>
            <div class="settings-card">
                <label>Database:</label>
                <button id="refreshDataBtn">Refresh Data</button>
            </div>
            <div class="settings-card">
                <label>Export Data:</label>
                <a href="{{ url_for('generate_report') }}" class="button" id="exportBtn">Export Reviews (CSV)</a>
            </div>
        </div>

    </div>
</div> <div id="resetPasswordModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>Reset Password</h3>
        <p>Enter a new password for the user.</p>
        <input type="password" id="newPasswordInput" placeholder="New Password">
        <button onclick="confirmReset()">Confirm Reset</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // NEW: Function to check and apply theme on load
    function applyThemeOnLoad() {
        // Use a unique key for admin theme
        const storedTheme = localStorage.getItem('adminTheme');	
        if (storedTheme === 'light') {
            document.body.classList.add('light-mode');
        } else {
            // Default to dark mode if nothing is stored or if it's explicitly 'dark'
            document.body.classList.remove('light-mode');
        }
    }

    // Call the function immediately before DOMContentLoaded to prevent flash of unstyled content
    applyThemeOnLoad();	

    // UPDATED: showTab function to manage sidebar active state
    function showTab(tab, element = null) {
        document.querySelectorAll('.container > div').forEach(div => div.style.display = 'none');
        document.getElementById(tab).style.display = 'block';
        
        // Remove 'active' from all sidebar links
        document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
        
        // Add 'active' to the clicked link (or the one identified by ID if element is null)
        if (element) {
            element.classList.add('active');
        } else {
             const link = document.getElementById(tab + "Link");
             if (link) {
                link.classList.add('active');
             }
        }
        
        // Update URL hash
        window.location.hash = tab;

        document.getElementById("overviewSection").style.display = (tab === "analytics") ? "block" : "none";
        
        if (tab === 'system_monitoring') {
            fetchPerformanceLogs();
            fetchModelAccuracy();
            fetchServerStats();
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        // Change: Use the new link IDs for initial tab display
        const urlHash = window.location.hash.substring(1);
        const initialTab = urlHash || 'analytics';
        showTab(initialTab); // The showTab function now correctly activates the corresponding link element

        const pos = {{ pos_count }};
        const neg = {{ neg_count }};
        const neu = {{ neu_count }};
        const aspects = {{ admin_aspect_data|tojson|safe }};

        function getChartColors() {
            const isLight = document.body.classList.contains('light-mode');
            return {
                text: isLight ? '#1e1f26' : '#f1f3f5',
                grid: isLight ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.05)'
            };
        }

        function drawCharts() {
            const colors = getChartColors();

            // Clear previous charts before drawing new ones (important for theme toggle)
            const sentimentCanvas = document.getElementById('sentimentChart');
            const aspectCanvas = document.getElementById('aspectChart');
            if (window.sentimentChartInstance) window.sentimentChartInstance.destroy();
            if (window.aspectChartInstance) window.aspectChartInstance.destroy();


            var ctx = sentimentCanvas.getContext('2d');
            window.sentimentChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Positive','Negative','Neutral'],
                    datasets: [{
                        data: [pos, neg, neu],
                        backgroundColor:
                            ['rgba(40,167,69,0.9)', 'rgba(220,53,69,0.9)', 'rgba(108,117,125,0.9)']
                    }]
                },
                options: {
                    responsive:true,
                    maintainAspectRatio: false,
                    plugins:{
                        legend:{ labels:{ color: colors.text, font:{ size:16 } } },
                        title:{ display:true, text:'Overall Sentiment Distribution', color: colors.text, font:{ size:20, weight:'bold' } }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true
                    }
                }
            });

            if(aspects && aspects.length > 0) {
                const labels = aspects.map(a => a.aspect);
                const posData = aspects.map(a => (a.label === "Positive" && a.score !== null) ? Math.round(a.score * 100) : 0);
                const neuData = aspects.map(a => (a.label === "Neutral") ? (a.score !== null ? Math.round(a.score * 100) : 50) : 0);
                const negData = aspects.map(a => (a.label === "Negative" && a.score !== null) ? -Math.round(a.score * 100) : 0);
                const maxAbs = Math.max(...posData, ...neuData, ...negData.map(Math.abs), 100);

                const aspectCtx = aspectCanvas.getContext('2d');
                window.aspectChartInstance = new Chart(aspectCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: "Positive", data: posData, backgroundColor: "rgba(40,167,69,0.8)" },
                            { label: "Neutral",	data: neuData, backgroundColor: "rgba(255,193,7,0.8)" },
                            { label: "Negative", data: negData, backgroundColor: "rgba(220,53,69,0.8)" }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                ticks: { color: colors.text, font:{ size:14, weight:'500' } },
                                grid: { display: false }
                            },
                            y: {
                                ticks: { color: colors.text, font:{ size:14 }, callback: v => Math.abs(v) + "%" },
                                min: Math.min(-maxAbs, -100),
                                max: Math.max(maxAbs, 100),
                                grid: { color: colors.grid }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: colors.text, font:{ size:15, weight:'600' } } },
                            title:{ display:true, text:'Aspect Sentiment Scores', color: colors.text, font:{ size:20, weight:'bold' } },
                            tooltip: {
                                callbacks: {
                                    label: function(ctx) {
                                        const v = ctx.parsed.y;
                                        return ctx.dataset.label + ': ' + Math.abs(v) + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Draw charts initially and whenever the theme changes
        drawCharts();

        // FIXED: Theme toggle logic now correctly stores and uses a unique key
        document.getElementById('toggleThemeBtn').onclick = function() {
            const isLight = document.body.classList.toggle('light-mode');
            localStorage.setItem('adminTheme', isLight ? 'light' : 'dark');
            // Re-draw charts with correct theme colors
            drawCharts();
        };
        
        document.getElementById('refreshDataBtn').onclick = function() { location.reload(); };
    });

    // NEW: Feedback status update function
    window.updateFeedbackStatus = function(feedbackId, newStatus) {
        if (!confirm(`Are you sure you want to change status of ticket ${feedbackId} to ${newStatus}?`)) {
            // Revert the dropdown selection if the user cancels
            const selectElement = document.querySelector(`tr[data-feedback-id="${feedbackId}"] select`);
            if (selectElement) {
                const currentStatus = selectElement.parentNode.previousElementSibling.querySelector('span').textContent.trim();
                selectElement.value = currentStatus;
            }
            return;
        }

        fetch(`/admin/feedback/update_status/${feedbackId}`, {	
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status: newStatus })
        })
        .then(res => res.json())
        .then(data => {	
            if(data.success){	
                const row = document.querySelector(`tr[data-feedback-id="${feedbackId}"]`);
                if (row) {
                    // This logic assumes the status badge is in the cell before the select dropdown's parent cell (index 5)
                    const statusCell = row.cells[5].querySelector('span');
                    const statusClass = `status-${data.new_status.toLowerCase().replace(' ', '-')}`;
                    statusCell.className = `sentiment-badge ${statusClass}`;
                    statusCell.textContent = data.new_status;
                }
                alert('Feedback status updated successfully!');
            } else {	
                alert('Failed to update feedback status: ' + data.message);	
                location.reload();	
            }	
        })
        .catch(error => {
            console.error('Error updating status:', error);
            alert('An error occurred while updating feedback status.');
            location.reload();
        });
    }


    // User management functions (unchanged)
    window.changeUserStatus = function(userId, activate) {
        fetch(`/admin/${activate ? 'activate_user' : 'deactivate_user'}/${userId}`, { method: 'POST' })
            .then(res => res.json())
            .then(data => { if(data.success){ location.reload(); } else { alert('Failed to change user status.'); } });
    }
    window.deleteUser = function(userId) {
        if(!confirm("Are you sure you want to delete this user?")) return;
        fetch(`/admin/delete_user/${userId}`, { method: 'POST' })
            .then(res => res.json())
            .then(data => { if(data.success){ location.reload(); } else { alert('Failed to delete user.'); } });
    }

    // Password reset modal (unchanged)
    let currentUserId = null;
    function resetPassword(userId) {
        currentUserId = userId;
        document.getElementById('resetPasswordModal').style.display = 'block';
    }
    function closeModal() {
        document.getElementById('resetPasswordModal').style.display = 'none';
        document.getElementById('newPasswordInput').value = '';
    }
    function confirmReset() {
        const newPassword = document.getElementById('newPasswordInput').value;
        if (!newPassword) {
            alert('Please enter a new password.');
            return;
        }
        fetch(`/admin/reset_password/${currentUserId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ new_password: newPassword })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert('Password reset successfully!');
                closeModal();
            } else {
                alert('Failed to reset password: ' + data.message);
            }
        });
    }
    
    // Aspect management functions (unchanged)
    function addAspect() {
        const name = document.getElementById('newAspectName').value;
        if (!name) {
            alert('Aspect name cannot be empty.');
            return;
        }
        fetch('/admin/aspect_categories/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: name })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Failed to add aspect: ' + data.message);
            }
        });
    }

    function deleteAspect(aspectId) {
        if(!confirm("Are you sure you want to delete this aspect?")) return;
        fetch(`/admin/aspect_categories/delete/${aspectId}`, { method: 'POST' })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Failed to delete aspect.');
                }
            });
    }

    function editAspect(aspectId, currentName) {
        const newName = prompt("Enter new name for aspect:", currentName);
        if (newName === null || newName.trim() === "") {
            return;
        }
        fetch(`/admin/aspect_categories/edit/${aspectId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: newName })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Failed to update aspect: ' + data.message);
            }
        });
    }

    // System Monitoring Functions (unchanged)
    function fetchPerformanceLogs() {
        fetch('/api/system_monitoring/performance_logs')
            .then(response => response.json())
            .then(logs => {
                const logsContainer = document.getElementById('performance-logs-container');
                logsContainer.innerHTML = '';
                if (logs.length === 0) {
                    logsContainer.innerHTML = '<p>No performance logs available.</p>';
                    return;
                }
                logs.forEach(log => {
                    const logElement = document.createElement('div');
                    logElement.classList.add('log-item');
                    const timestamp = new Date(log.timestamp).toLocaleString();
                    let eventTypeHtml = `<span class="status-badge success">SUCCESS</span>`;
                    if (log.event_type.includes('fail') || log.event_type.includes('error')) {
                        eventTypeHtml = `<span class="status-badge fail">FAIL</span>`;
                    }
                    logElement.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> ${eventTypeHtml} <span class="log-message">${log.message}</span>`;
                    logsContainer.appendChild(logElement);
                });
            })
            .catch(error => {
                console.error('Error fetching logs:', error);
                document.getElementById('performance-logs-container').textContent = 'Failed to load performance logs.';
            });
    }

    function fetchModelAccuracy() {
        fetch('/api/system_monitoring/model_accuracy_check')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('model-accuracy-container');
                if (data.error) {
                    container.textContent = data.error;
                    return;
                }
                container.innerHTML = `
                    <div class="model-check-item">
                        <p><strong>Review Text:</strong> ${data.text}</p>
                        <p><strong>Model Prediction:</strong> <span class="sentiment-badge ${data.predicted_sentiment.toLowerCase()}">${data.predicted_sentiment}</span></p>
                        <p>Is this prediction correct?	
                            <button onclick="submitFeedback(${data.id}, 'correct')" class="correct">Correct</button>
                            <button onclick="submitFeedback(${data.id}, 'incorrect')" class="incorrect">Incorrect</button>
                        </p>
                    </div>
                `;
            })
            .catch(error => {
                console.error('Error fetching model accuracy sample:', error);
                document.getElementById('model-accuracy-container').textContent = 'Failed to load model accuracy check.';
            });
    }

    window.submitFeedback = function(reviewId, sentiment) {
        fetch('/api/system_monitoring/model_feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ review_id: reviewId, correct_sentiment: sentiment })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert('Feedback submitted! A new sample will be loaded.');
                fetchModelAccuracy();
            } else {
                alert('Failed to submit feedback.');
            }
        })
        .catch(error => {
            console.error('Error submitting feedback:', error);
            alert('An error occurred while submitting feedback.');
        });
    };

    function fetchServerStats() {
        fetch('/api/system_monitoring/server_stats')
            .then(response => response.json())
            .then(stats => {
                const statsContainer = document.getElementById('server-stats-container');
                statsContainer.innerHTML = `
                    <div class="stat-item"><span class="stat-label">CPU Usage:</span> <span class="stat-value">${stats.cpu_usage_percent.toFixed(2)}%</span></div>
                    <div class="stat-item"><span class="stat-label">Memory Usage:</span> <span class="stat-value">${stats.memory_usage_percent.toFixed(2)}%</span></div>
                    <div class="stat-item"><span class="stat-label">Disk Usage:</span> <span class="stat-value">${stats.disk_usage_percent.toFixed(2)}%</span></div>
                    <div class="stat-item"><span class="stat-label">Datasets Stored:</span> <span class="stat-value">${stats.datasets_stored}</span></div>
                `;
            })
            .catch(error => {
                console.error('Error fetching server stats:', error);
                document.getElementById('server-stats-container').textContent = 'Failed to load server statistics.';
            });
    }
</script>
</body>
</html>